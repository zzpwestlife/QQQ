# TQQQ 双核动态平衡策略操作手册 (V22.0)

> **文档版本**: 1.0  
> **适用对象**: 有一定风险承受能力的成长型投资者  
> **核心标的**: QQQ (纳斯达克100 ETF), TQQQ (3倍做多纳斯达克100 ETF)  
> **策略类型**: 趋势跟踪 + 均值回归 + 波动率控制

---

## 1. 投资目标与策略说明

### 1.1 核心逻辑
本策略旨在通过 **双核动态配置** (QQQ + TQQQ)，在牛市中利用 3 倍杠杆 (TQQQ) 放大收益，在震荡市和熊市中通过切换至 1 倍杠杆 (QQQ) 或空仓 (Cash) 来控制回撤。策略基于技术指标自动识别市场状态，规避情绪化交易。

### 1.2 标的特性
| 标的 | 代码 | 跟踪指数 | 杠杆倍数 | 适用场景 | 风险等级 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **Invesco QQQ** | QQQ | Nasdaq-100 | 1x | 长期持有、防御、震荡市 | 中高 |
| **ProShares UltraPro QQQ** | TQQQ | Nasdaq-100 | 3x | 单边牛市、强势反弹 | 极高 |

### 1.3 适用行情与风险偏好
*   **适用行情**: 单边上涨趋势、宽幅震荡向上。
*   **不适用行情**: 长期窄幅震荡、急跌慢涨的阴跌市。
*   **建议持仓周期**: 3年以上（跨越牛熊周期）。
*   **风险提示**: TQQQ 具有**波动率损耗**特性，不适合长期“死拿”，必须配合择时策略。

---

## 2. 策略核心特性 (Feature List)

本策略代码 (`code/tqqq.py`) 实现了以下 8 大核心风控与增强特性：

1.  **双核动态配置**: 根据市场状态在 TQQQ (进攻)、QQQ (防御/平衡) 和 Cash (空仓) 之间自动切换。
2.  **MA200 + MA20 趋势判断**:
    *   **MA200**: 判断牛熊分界线。
    *   **MA20**: 判断短期趋势强弱。
3.  **6 种市场状态自动识别**:
    *   `NORMAL`: 站上 MA200 -> **QQQ 45% + TQQQ 45%** (常态双核)
    *   `ZONE_BATTLE_ATTACK`: 跌破 MA200 但站上 MA20 -> **TQQQ 99%** (博反弹)
    *   `ZONE_BATTLE_DEFEND`: 跌破 MA200 且跌破 MA20 -> **QQQ 99%** (防御)
    *   `ZONE_DESPAIR_TQQQ`: 回撤 >30% -> **TQQQ 99%** (绝望区抄底)
    *   `BEAR_CASH`: 跌破 MA200 但回撤 <10% -> **Cash 100%** (避险)
    *   `TOP_ESCAPE`: 历史高位放量大跌 -> **QQQ 90%** (逃顶)
4.  **Anti-V 反转过滤**: 防止假突破追高。从防御状态切换到进攻状态需满足：
    *   **冷静期**: 至少观望 2 天。
    *   **趋势确认**: MA20 必须拐头向上。
5.  **T+1 先卖后买机制**:
    *   **Day T**: 发出调仓信号，**只卖出**多余仓位。
    *   **Day T+1**: 资金结算后，**买入**目标仓位。
    *   **目的**: 避免资金未到账导致的融资利息，确保 0 融资。
6.  **禁止融资 (No Margin)**: 严格限制买入金额不超过账户现金，杜绝杠杆风险。
7.  **ATH 历史高点追踪 + 放量逃顶**:
    *   当价格接近历史高点 (ATH * 95%) 且成交量放大 (2x Avg Vol) 收阴线时，强制减仓。
8.  **未完成订单检测**: 每次运行前自动检查是否存在挂单，防止重复下单。

---

## 3. 实战操作步骤

### 3.1 环境准备
1.  **券商账户**: 支持美股交易（如 IBKR, 富途, 老虎等），开通融资融券账户（虽然策略不融资，但 TQQQ 可能需要权限）。
2.  **运行环境**: Python 3.x, 依赖库 `pandas`, `numpy` 等。
3.  **数据源**: 确保已连接高质量美股数据源（如 Polygon, AlphaVantage 或券商 API）。

### 3.2 每日操作流程 (美股收盘后/开盘前)

#### **Step 1: 运行策略脚本**
在终端运行策略代码，获取当日信号：
```bash
python3 code/tqqq.py
```

#### **Step 2: 查看输出信号**
策略会输出类似以下的日志或弹窗：
*   **无操作**: `[SKIP] 状态未变，继续持有`
*   **调仓信号**:
    ```text
    [SIGNAL] 状态切换: NORMAL -> ZONE_BATTLE_DEFEND
    【卖出执行】TQQQ: 计划卖出 500 股...
    ```

#### **Step 3: 执行交易 (T+1 模式)**

*   **情况 A: 仅持有 (无信号)**
    *   操作：无。安心睡觉。

*   **情况 B: 触发调仓 (Day T)**
    1.  **登录券商 APP**。
    2.  **卖出操作**: 根据策略提示的股数，**市价单 (Market Order)** 卖出需减仓的标的。
    3.  **记录**: 在交易日志中记录“已卖出，等待结算”。
    4.  **注意**: 当日**不要买入**，等待资金结算（通常为 T+1）。

*   **情况 C: 执行买入 (Day T+1)**
    1.  次日再次运行脚本，策略会提示 `[T+1] 资金已结算，执行买入计划...`。
    2.  **买入操作**: 根据策略计算的股数，**市价单 (Market Order)** 买入目标标的。
    3.  **核对**: 确保买入后现金余额 >= 0，未产生融资余额。

#### **Step 4: 设置止损 (可选)**
虽然策略自带止损逻辑（状态切换），但为防范黑天鹅，可设置 **移动止损 (Trailing Stop)**：
*   **标的**: TQQQ
*   **触发价**: 现价回撤 10% - 15%
*   **有效期**: GTC (Good Till Cancelled)

---

## 4. 风险与合规提示

### 4.1 杠杆 ETF 风险
1.  **波动率损耗 (Volatility Drag)**:
    *   TQQQ 每日重置杠杆。若指数先跌 10% 再涨 11.1% (回到原价)，TQQQ 将跌 30% 再涨 33.3%，最终净值仅为 `0.7 * 1.333 = 0.933`，亏损 6.7%。
    *   **结论**: 震荡市中 TQQQ 会自动磨损净值，必须依靠策略在震荡期切换回 QQQ。
2.  **最大回撤**:
    *   历史上 QQQ 最大回撤约 80% (2000年)，对应 TQQQ 可能归零。
    *   本策略通过 MA200 止损，旨在将 TQQQ 的回撤控制在可接受范围，但极端情况下仍可能面临 50%+ 的回撤。

### 4.2 极端行情应急预案
| 情景 | 现象 | 操作建议 |
| :--- | :--- | :--- |
| **熔断 (Circuit Breaker)** | 标普500跌7%，全市场暂停交易15分钟 | **保持冷静**。策略通常在收盘判断，盘中熔断不操作。若收盘跌幅巨大，策略次日会自动触发减仓信号。 |
| **流动性枯竭** | 买卖盘差价 (Spread) 极大 | 使用 **限价单 (Limit Order)** 代替市价单，价格设定在买一/卖一中间。 |
| **券商系统宕机** | 无法登录 APP | 1. 拨打券商电话交易台下单。<br>2. 登录盈透证券(IBKR)等备用 TWS 终端。 |

### 4.3 税务影响 (仅供参考)
*   **短期资本利得税**: 本策略交易频率中等，可能会产生较多短期资本利得。建议在免税账户 (如 IRA, 401k) 中运行，或咨询税务师。
*   **洗售规则 (Wash Sale)**: 频繁买卖同一标的可能触发洗售规则，导致亏损无法抵税。策略的 T+1 机制在一定程度上缓解了此问题，但仍需注意 30 天内的反复交易。

---

## 5. 监控与复盘模板

### 5.1 每日/每周检查清单 (Checklist)
*   [ ] **价格与均线**: QQQ 当前价格 vs MA200, MA20。
*   [ ] **市场状态**: 确认当前策略状态 (如 `NORMAL` vs `DEFEND`)。
*   [ ] **杠杆倍数**: 检查账户实际杠杆率 (总市值 / 净资产)，应保持在 1.0 (全仓QQQ) ~ 2.0 (半仓TQQQ) ~ 3.0 (全仓TQQQ) 之间。
*   [ ] **成交量**: 是否出现异常放量滞涨 (逃顶信号)。

### 5.2 复盘表格模板 (CSV/Excel)
建议建立一个 `.csv` 文件记录每笔交易，格式如下：

```csv
日期,操作,标的,数量,成交价,手续费,策略状态,备注
2023-01-05,BUY,TQQQ,100,18.50,1.00,ZONE_DESPAIR_TQQQ,绝望区抄底
2023-03-10,SELL,TQQQ,100,24.20,1.00,NORMAL,切换回常态配置
```

**关键指标计算公式 (Excel)**:
*   **胜率**: `盈利交易次数 / 总交易次数`
*   **盈亏比**: `平均盈利金额 / 平均亏损金额`
*   **最大回撤**: `(历史最高净值 - 当前净值) / 历史最高净值`

---

## 6. 附录

### 6.1 常见问题 FAQ

**Q1: 为什么不一直持有 TQQQ？**
A: 长期来看 TQQQ 收益惊人，但中间可能经历 -90% 的回撤。策略的目的是为了让你在回调时“拿得住”，并在大跌前“跑得掉”。

**Q2: 资金量小适合这个策略吗？**
A: 适合。TQQQ 和 QQQ 流动性极好，几百美元即可开始投资。注意券商的最低佣金限制。

**Q3: 为什么是 MA200 而不是 MA250？**
A: MA200 是美股机构公认的牛熊分界线，信号更具共识性。

**Q4: 可以用融资 (Margin) 买更多吗？**
A: **绝对禁止**。TQQQ 本身已经是 3 倍杠杆，再加融资会使风险呈指数级上升，极易爆仓。

### 6.2 常用资源链接
*   **ProShares TQQQ 官网**: [ProShares UltraPro QQQ](https://www.proshares.com/our-etfs/leveraged-and-inverse/tqqq) (查看持仓、费率)
*   **Invesco QQQ 官网**: [Invesco QQQ](https://www.invesco.com/qqq-etf/en/home.html)
*   **纳斯达克 100 指数**: [Nasdaq-100 Index](https://www.nasdaq.com/market-activity/indexes/ndx)
*   **恐慌指数 (VIX)**: [CBOE VIX](https://www.cboe.com/tradable_products/vix/)

### 6.3 券商自选股导入文件 (Watchlist.csv)
复制以下内容保存为 `.csv` 文件，即可导入 TradingView 或券商软件：

```csv
Symbol,Description
QQQ,Invesco QQQ Trust
TQQQ,ProShares UltraPro QQQ
SQQQ,ProShares UltraPro Short QQQ
^NDX,Nasdaq-100 Index
```

---
*Disclaimer: 本文档仅供技术交流与教育目的，不构成任何投资建议。市场有风险，投资需谨慎。*
